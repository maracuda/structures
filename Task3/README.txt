Задание

задача про товары:
 товар(идентификатор, название)
 контрагент (идентификатор, название)

 мы умеем покупать пачку товаров от контрагента за определенную сумму (они поступют на склад)
 мы умеем продавать пачку товаров другому контрагенту за сумму отличную от покупки (товары уходят со склада)

после нескольких покупок и продаж нужно уметь отвечать на следующие вопросы
 1. сколько осталось товаров на складе от конкретного контрагента (по идентификатору товара)
 2. на какую сумму осталось товаров на складе от конкретного контрагента (по идентификатору товара)


при продаже товара мы должны иметь соответствие (идентификатор товара <-> сумма себестоимости)
где себестоимость единицы товара = (осточная стоимость всех товаров) / (остаточное количество всех товаров на складе)

 товары продаются в порядке их поступления на склад
 можно продавать некупленный товар (уходить в минус)
 при продаже некупленного товара себестоимость не списывается
 
 
Решение!
Создаем сущности товара и контрагента, плюс сущность закупки (Batch).

Класс Stock - склад, заведует закупками. При новой покупке добавляет новый Batch в очередь.
Очередь, потому что нам не важен каждый элемент из товаров, а важен только последний и порядок следования. очередь реализована на массиве - плюс?
При продаже в минус создаем специальный Batch с Guid.Empty в качестве id поставщика и нулевой ценой, отрицательным количеством, далее все минусовые продажи туда плюсуем. При покупке такого товара пытаемся сократить баланс(плюсуем в отрицательное количество).


Метод FirstCost вычисляет для каждого товара его себестоимость по поставщику. Решил не хранить как справочное значение, ведь при каждой оперции покупки/продажи придется заново пересчитывать. А так считаем только при продажах.